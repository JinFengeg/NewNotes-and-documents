# 项目记录

2021/10/7，东北大学校徽在lcd上显示成功

2021/10/8，东北大学校徽在lcd上显示成功，相应的字符串显示成功

字符串只显示一个点是因为循环只循环一次，没有配置结构体

2021/10/9，东北大学校徽在OLED上显示成功，但是把校徽放在oled的正点例程上时出现刷新两次后稳定的情况，在ADC多通道文件里的移植项目的oled文件中，校徽显示正常，显示部分的switch里面的数值让我改了123456，其中出现过字符漂移现象，原因是最低行的位置过低导致字体显示不从而乱码，添加完ADC之后黑屏未解决。

2021/10/10，黑屏原因怀疑和adc_debug()函数有关，当把此函数放回oled_show中时，屏幕恢复正常，位置调整正确，但是无法显示符号，原因是第一个if中对温度进行了重定义，温度T自己设值显示正确。状态使用循环逐一表示，power成功通过读取adc值显示，但是Get_Adc_Average()平均完的数就是零。去掉平均后显示正常，电量SOC显示正常，通过乘以100，再加上%表示，可以显示个位。

2021/10/11，今天上午学习最优化，查课问题困扰我了，最近数学需要加强了，十一期间没有看数学导致跟不上，项目方面程序上没有改动，我把光敏传感器BH1750的手册看了一半，最近感觉优先级是期末>个人研究方向>项目进度，所以以后上课期间就是十点之后开始搞项目，晚上八点之后开始学研究方向，除非特殊情况，数学要把刷的题刷完

2021/10/12，今天上午没去上薛老师的课，倒也不算后悔，就是总感觉少了点什么，白天一直在学数学，不做题不知道问题原来这么多，晚上七点开始学习，看了不到三个小时的视频，接触触摸屏了，但是我现在对这些基础开始缺乏兴趣了，眼界和能力提高了之后也就想追求一些更多的了，晚上十一点才开始看手册，目前看来时间分配的还算可以，以后水课就用来学数学，晚上可以八点之后开始学32，七点之前都用来学习课程，中间休息一个小时就够了，明天要把手册看完，后天把程序写完，然后看看模块能不能先买，我这边就可以调试了，总感觉项目进度开始变慢了，希望最后别影响期末呀。

2021/10/13，今天从早忙到晚，晚上上课的时候是最累的，现在挺过去了反而不困了，今天项目零进展，晚上下课就去学触摸屏了，又是一个交流窗口的好办法，明天向他们请教下PCB的画法，以后可能每周的周一周二周四都是学数学的日子，晚上八点之后学32总感觉不尽兴，每次都是把项目时间挤得只剩下十几分钟，如果条件允许的话还想和许文涵组讨论下5g模块的应用。

2021/10/14，今天又是学了一天数学，主要做的就是计算数值分析第二章前面的A=LU到LDM到GGT到TM,但感觉其实东西也不算多主要就是计算，总是出错，今天把触摸屏看完了，但是没有写程序，这肯定是不行的，晚上项目手册看完了，就是隔得有点久，一天没看有点忘了，但我感觉通讯起来简单。今天看了点linux的视频，开始渐渐了解了，似乎linux并不是一个终点而是一个新的起点，我的方向应该是嵌入式驱动研发工程师，硬件软件都搞的那种，pcb今天他们讲完了之后，明天晚上把pcb看下，把布局和走线研究明白

2021/10/15，今天把数值分析和最优化的课后习题都做完了，这一周没干其他就是刷数学题，刚才数学测试怎么还错了三道题，不过继续刷题最后肯定能拿个高分，今天把看门狗看完了，看门狗我觉得没啥用，放在高级篇搞不懂为啥，接下来就是SD卡了，今天没做项目，明天把项目的光敏传感器程序写完，中午跟潘学忠吃个饭，下午继续看视频。今天中午看到了有趣的评价，我目前的单片机属于入门鸡初期，C语言属于小菜鸡末期。linux属于没入门。等寒假有闲心了就做下总结吧。

2021/10/16，今天是星期六，本来聚餐挺开心的，但是上午走之前实物到了，虽然已经有了足够的心理准备了，但是每次调试都会崩溃，刚开始我以为我对模拟IIC有足够的把握，这是我低温供电项目里最后一个单独模块调试了。今天调试到晚上十一点半，王鹤翔在催所以我当天没写项目记录。

2021/10/17，今天的项目记录又是我周一补上去的，如果说项目进度的话，可以说是突飞猛进，今天把最后一个单独的模块攻克了，并且在晚上的时候优化了下oled屏幕的显示情况，把清屏函数去掉了，因为我想起来字体库的时候是一个一个16*8的矩阵，会出现覆盖而不是重叠现象，目前还把光敏信号传到显示屏上了，晚上跟王震师兄一起回寝室还是有帮助的，虽然我周末两天没有学新的知识，但目前的学习路径是越来越清晰了，现在打算是先把野火视频里的大师篇看完，然后学习C语言里的数据结构，回调函数啥的，然后是学习RTOS操作系统，为了以后方便入门LINUX系统，没想到有一天我也会看大师篇，SD卡什么的，我没有实物，一会看看能不能找到个啥的。

2021/10/18，今天是正常顺序写的了，两天没写记录对我心情以及方向都出现了模糊，昨天把最后一个的单独模块调试成功，晚上的时候我有了一个idea，我打算把另一个光敏传感器做成感应球，人手放上去之后可以通过亮度以及持续时间来把自然环境和人手区分开，当人手遮住一定时间后，屏幕亮起显示数据，当人手再次遮住一定时间后关闭屏幕，初衷还是希望程序更加智能一些，把另一个传感器也用上，在一个是从实际情况出发操作人员不可能时刻在观察屏幕，如果变成有需要就看下屏幕，就好像手机屏幕一样。

2021/10/19，今天上了一上午数学，下午的时候只是把例题做了，晚上六点来的实验室，开始学视频，今天收获真的好多，我学到了如何分配内存，终于进入全屏模式了，晚上不到十点我就等不及了，终于把心心念念的锁屏功能加上去了，现在项目可以说是越来越人性化了。

2021/10/20，昨天晚上在和王震师兄一起回寝的路上，跟我提出了一个很重要的意见，就是程序不能用死循环，要加个中断，这一点要记住，到时候移植的时候要改下，今天上午开始刷数值分析第三章的习题了，但是感觉进度有点慢了，今天晚上快九点才回到实验室，然后大四师弟就开始找我聊天，导致我今天debug的串口没做出来，不过我也确实没有啥特别着急的，这周末就要开始焊板子了，应该是拿出去焊。今天32看完了一节，不过吧，我现在可能是学的有点深了，还没用上这些，导致我理解起来麻烦了点。

2021/10/21，最近快焊板子了，我这边也要把中断加上去，还要看下逻辑上面那里需要改，今天上午做了会数值分析的题，下午上的课复习了下第二章的课后习题，让我也有了更深刻的认识，晚上视频开始看的慢了，但是质量提高了，学习了下hex文件和bin文件里面长啥样，那些十六进制的数都有啥作用，然后看了会中断，明天争取把中断加到oled里面。其他的没剩啥了。明天要继续做题，争取把第三章习题做完，下午上下最优化的课。下午要是没事的话，就吃完饭直接来实验室吧，项目这边估计这周末快结束了。

2021/10/22，估计周末就要焊板子了，明天要把需要调试的功能想清楚，分模块的调试，这样程序上出错率低，今天看视频差不多看了两个小时，说实话视频有点看不下去了，刚开始还是用到了全面屏，但是越往后学就感觉理论东西越多，或许对以后有帮助但是对目前用处真的不大，也许我应该跳着看视频了，晚上项目调试花的时间长一些，今天算是把紧急开关完成一半了，明天有时间就把紧急开关写完，很期待去沈自所调试程序。又到了一周一度的项目时间，上周上课的时候都有点反应不过来了，今天真是做了一天的题，但是效率有点低，开始看手机了。

2021/10/23，今天是一个里程碑的一天，我把除了温度传感器之外的程序都整理好了，用rct6的板子跑逻辑是正确的，接下来移植到cbt6的板子上已经没有技术上的问题了，今天从早累到晚，但是一切都是值得的，明天再分模块的把cbt6的程序写完，有空可以把温度传感器通讯下，然后就可以等着板子到了就可以去沈自所了。

2021/10/24，今天也是一个里程碑式的一天，我把所有的程序都整理好了，移植程序也OK了，接下来的问题是移植到CBT6上会不会出错，以及关于电池电量准确性的难题，初步的想法就是电池充满电之后让他放电到放电截止电压，记录电压随时间变化的数据，然后是找一些方法，人为规定下电池的SOC，学了一晚上的视频，今天算是学出点头了，我已经会并理解分配内存的方法了，很期待明天的视频。接下来就是等待板子到了，之后去沈自所学习了。

2021/10/25，项目方面今天把逻辑又跑了一遍，发现了在节能模式下，进入紧急状态会出现卡死现象，已解决。目前不需要将迷你板着急报销。白天一直在学数学，晚上学到了电源管理。

2021/10/26，初步定在周四晚上去刷沈自所的副本，今天来实验室比较早，视频看了四个小时左右，但是电源管理中的睡眠模式和待机模式不知道为啥，串口打印的时候可以看出顺序是正常的，但是居然可以烧录进去，还是程序上出问题了，中断解决之后，还有其他的问题，项目方面看他们焊板子差不多一个小时，但是感觉没学到啥东西，明天要把debug在搞一搞，程序也再看下，不能在金博士面前露怯。

2021/10/27，希望明天能有个圆满的结局，让师兄认可我，也是我展示自己实力的一次重要的机会，晚上看视频但是没有写程序总觉得那不是我的东西。目前看来迷你板还要陪伴我半年的时间，linux真的是不着急学了,估计明年暑假的时候能学出点成果来吧，到时候应该就可以接触到无线模块了这么看来，迷你板其实不报销也可以了，不然还不容易留在自己手里了。晚上的时候震哥决定去荣耀了，搞硬件驱动的居然可以达到40w年薪，羡慕了，我就是拼尽全力也要拿到这样的工作。

2021/10/28，今天师兄没在，就好像打副本boss没有在场，焊板子就能有四个小时，对我来说还算是有些经验上的收获，今天主要学习的是熟悉PCB对于各个元器件的封装有了更深刻的认识，顺便说一句沈自所的环境不适合我，太过压抑，我更喜欢那种自由充满激情的生活。明天上午先去学数值分析吧，把数学收个尾巴，下午去洗澡放松放松，然后去实验室抓紧把32的野火视频学完，接下来进入C语言的阶段。

2021/10/29，今天把焊好的板子取回来了，明天开始调试，内心还是有些紧张的，毕竟之后老师的主要关注点就在我身上了，对我来说也是一次正式的在同门面前展现我真正实力的时刻了。今天对我来说是一个重要的日子，我把野火mini的视频看完了。

2021/10/30，今天学了一天的C语言，明天把OLED整上去，看下效果，目前板子可以调了，明天就可以正式的开始干活了。

2021/10/31，这周的开心周末结束了，进展可以说是突飞猛进，项目而言不仅板子焊完了，调试方面也已经实现在RCT6上的功能，接下来要做的工作就是等第二版板子做出来，然后再调试下，等太阳能板到了之后再调试下，估计硬件全了的情况下，搞一周应该就能出来了。

2021/11/1，开启了新的一个月，老师今天开始催我的进度了，等到太阳能板到了之后就得抓紧调试了，周四能到的话，我周五就不需要休息了，继续调试，争取本周的周末三天把项目弄的差不多，周末准备组会了。

2021/11/2，项目方面可以说是零进展，只学数据结构并不适合我，接下来的晚上先学几节数据结构，然后再学RTOS，试试水。

2021/11/3，项目进度可以说是缓慢，今天把串口供电转换成了USB供电，本来打算晚上的时候整个活出来，想想还是算了。

2021/11/4，今天晚上用可调电源测了一晚上的电路，但我确实对这个不感兴趣，说实话RTOS对我来说有一种迷人的魅力，我很好奇他到底是如何建立框架的。如果周六进行组会的话，明天我早上就来实验室先学数学一上午，然后学rtos,争取明天把系统弄明白然后上项目。

2021/11/5，今天下午的时候把4462以及太阳能板供电3.3测试成功，目前RTOS学到任务挂起和释放了，感觉把系统放到项目中是越来越近了，而且我对系统也有了大概的认识，很庆幸可以在研一上的时候接触到RTOS，入学如今两个月了，但实力上有了质的飞跃，很庆幸遇到了王老师，很庆幸本科毕业一周就开始做项目了，很庆幸做的项目里自己负责的是对32的控制，这让我更容易的入门，很庆幸遇到王震师兄，可以说是我嵌入式上的领路人，让我渐渐的知道自己做的是什么，原以为OS是我这辈子都接触不到的东西，现在看来是我未来必将从事的研究方向。

2021/11/6，今天上午把数值分析的第四章做完了，感觉这种方法还可以，明天上午可以接着做第六章的习题，然后把期中考试完成。下午的时候就开始看RTOS一直看到快十点。我再感兴趣也不能这么学，一天应该 只能学8个小时，现在RTOS已经算是有点框架的知识了，不得不说操作系统确实让我大开眼界，感觉嵌入式确实很难，调试难，入门难，而且学的东西是真的多。项目方面的东西倒是没有啥进展，明天睡到自然醒吧。

2021/11/7，今天的项目进度为零，这周六周日没做别的，就是上午学数值分析，下午开始学RTOS，晚上十点之后随便干点啥，现在RTOS应该在寒假前能学完，其他的没什么特殊的了，对数学有点慌了，明天开始刷数学真题吧，有紧迫感了。

2021/11/8，今天金博士给我增加了几个任务：加一个呼吸灯，加一个eeprom，加一个rs485，引脚方面倒是足够了，说实话早应该这样了，老师就是不怎么催进度导致上个周末都没干活，呼吸灯用到了定时器，这挺好的，485用到了串口，往eeprom里存储数据，这三个一直都是我想做的，在我看来这才是完整的项目，如果说没有掉电保护，那我想读以前的数据怎么可能找到呢

2021/11/9，今天提前走了，所以是10号补上去的，今天做啥有点忘了，第二天就是中特期末，rtos的视频看了一集。项目进度方面是完成了led呼吸灯的功能，我把呼吸灯放到oled里面，跟着屏幕一起运行。延迟方面还可以，影响不大

2021/11/10，昨天是因为回去太晚了，所以是11号补上去的，今天是中特期末考试，其他的都没咋做，就是把eeprom的通讯写完了，其他的就没有什么了

2021/11/11，今天是光棍节，我过的很不开心，他妈傻逼**又他妈的骂我，不过我感觉不一定骂的是我，说的是这帮研一怎么怎么滴，估计当年李田洋师兄也是这么骂过来的，人家能忍，我为啥不能忍。项目方面，eeprom我也整上了。明天上午看看干点啥，或者休息下啥的。

2021/11/12，今天把东西搬回了寝室，不过我并不打算今晚就在寝室搞项目，对于今晚而言更重要的是我要把金博士说的话总结出来，做一个任务清单出来，

2021/11/13，今天我把第一个中断整完了，这么做确实好了不少，只不过屏幕有点雪花，还需要修改

2021/11/14，今天认真查看了下师兄当时写的手稿，明白师兄说的状态机是什么概念了，接下来的任务分成两大部分，其中一个是把main主逻辑分成单独的模块，上下行不再有逻辑上的顺序，然后把目前的紧急开关中断重写，把这个中断服务函数里面全是标识位，在主函数的mainwhile循环中放的都是if判断，以及单独的模块，在中断中存放每个模块的启动条件，最后是标识位，另一个中断存放传感器的读取，最后一个中断存放485的控制指令，这个控制指令整个switch来判断控制指令的每个字节，然后控制相应的标识位，做到控制指令的底层驱动，另一部分的就是关于控制指令的工作，每个单独的模块要细化到可以拼凑起来完成各种任务。明后天把第一大部分做完，然后把控制指令做完，先用ttl试试效果。

2021/11/15，今天把温度检测以及外部中断的函数改成了状态机，但是我总有种脱裤子放屁的感觉，看起来变了，但是判断的位置还是没变，不知道这是不是所谓的状态机

2021/11/17，昨天回家了，今天回来的，项目进度这块，把状态机都改完了，发现了关于标识位01的问题，当循环条件时标识位时，只能在判定标识位处加上标识反位，不然会破坏循环或者，死循环，目前剩下的就是485及其服务程序，然后移植到CBT6上

2021/11/18，今天白天没怎么学进去，应该是休息不好，晚上的时候把3337的数据手册看了一半了，就可能为了精准的测量电量要加上这款芯片，其实我感觉这些芯片说到底都是外设，都不过如此，还得是学操作系统，才行。

2021/11/19，今天开始写485远程控制的程序，把师兄推荐的串口调试助手看了下，其他的没咋做，今天是我的放松天

2021/11/20，首先，写一个控制命令用来显示当前屏幕显示内容的。今天项目进度先把第一项开个头

2021/11/21，今天没咋做项目

2021/11/22，今天下午师兄帮我看程序聊了一个小时，下面总结下下一轮程序需要改动的东西，

2021/11/23，今天不看程序了，明天花一个上午来写程序，争取都写完

2021/11/24，拆除循环，今天把循环都拆除了，但是引脚逻辑可能有些问题，然后先移植到CBT6，然后再整485.

2021/11/25，今天下午数学了进去了，总结起来就是我的状态出问题了，今晚本来打算编程的，但是也没有写，制定下明天需要做的事情，首先，是上午把CBT6的程序移植好，中午去泡个澡，然后回寝室背电脑去实验室，先把状态机移植到原先的板子上，然后在移植到最新的板子上，明天去实验室的主要目的就是听一听研三师兄的汇报，听完之后再调试最新的板子，明天未必有时间用上太阳能板

2021/11/26，今天把CBT6的移植程序写完了，之后就等着板子到就可以了，485的调试程序还要写

2021/11/27，今天晚上板子出问题了，怀疑是pwm定时器出错，485程序也出问题了，先用精英板调试的，但是例程里初始化了2个串口，明天问客服，明天需要板子调试明白，哪里有问题啥的

2021/11/28，今天调试了下485，新板子，结果不太理想，明天先把定时器搞明白，起码晚上去沈自所的时候显示屏啥的集成能出来，才行。

2021/11/29，目前解决很多问题，只剩下ADC了，问题不大，以后晚上教学楼不让呆了之后来实验室调ADC，我就不相信了！！！！

2021/11/30，这是12/2晚写的，当时的我还很天真，以为ADC很好搞的，这天我把ADC测量的数据变得稳定，但是测得的数是不准确的

2021/12/1，这天我把需要温度传感器出现的数据不变化解决了，然后把ADC以及PD1引脚真正的改完了

2021/12/2，今天把电池电量检测写完了，也是完全准备好去滑雪场了。

2021/12/20，期末考完了，最优化考砸了，其他人都考得挺好，我最优化如果挂了，那明年还要接着学，今天是考完之后回实验室的第一天，我看了下FREERTOS的视频，之前记得东西都快忘了，不过没有关系之前学的都是基础，接下来多编程就行，晚上的时候我把明天开会简单整理了下几条重要的，陈浩楠奶奶过世了，让我想起了自己的奶奶

2021/12/21，今天上午整理了下目前的进度以及未来的计划设想，跟师兄提了下想要往物联网方面靠拢，师兄明确表示了支持，不过这个想法没有向王老师汇报，今天也知道了王老师对我们项目的态度，就是为了金博士的毕业，发一篇专利。我认为这是应该的，金博士带我们挺辛苦的，我还不知道怎么报答他呢，接下来是目前项目的进度

2021/12/22，今天进展神速，而且我感觉今天好像是光顾着给老师打工了，RTOS就学了一个小时，今天把485实现了，并且大致规划了下控制指令，这周就可以把485控制指令以及eeprom内部的存储单元规划好

2021/12/23，今天进展也是突破性的，485控制指令中查看部分已经写完，接下来就是遥控部分了，eeprom已经确定好使了，明天我话一整天就能把eeprom和485部分彻底结束，变成我已经攻克的部分了，那么自此师兄的要求也是完全达到了，在新板子没有到之前，我接下来就是包天学rtos，争取早日可以上个系统

2021/12/24，今天把金博士的要求都解决了，应对周一的滑雪场副本已经没问题了，听说周一好像不打算去滑雪场了，接下来需要做的就是

2021/12/25，今天我看了一整天的rtos不过看到比较少，只看了两节视频，但是我对程序的回忆大部分了，今天我仔细合计了下，老师给的排名没毛病，人家干了半年我才干了三个月，确实应该把我排在最后而且也没啥用了，正好我今天学一天之后，终于是对rtos产生了兴趣，明天看看情况要不要下午再来，反正以后的第一任务就是学rtos和专利了，其他的都可以往后排

2021/12/28，今天我感觉真正的物联网开始对我露出獠牙了，金博士轻轻地一句zigbee网关，让我从下午到现在忙的要死才下定决心去做这个，相比之前的那些协议真的是基础协议呀，无线协议没有一款是好学的，但我不能只学zigbee，我肯定是要一边学linux一边学这个，争取我回家之前把zigbee网关弄出来，无限通信确实牛逼，但技术也确实要高的多

2021/12/30，我目前需要做的事情有三件：1.RTOS学习，2.专利书写，3.项目，这三种RTOS是属于我的自学研究方向，专利书是由王老师催进度，目前的截止日期是一月十五日，项目是由金博士催促的，对于我而言，新一版的板子没有焊好之前，或者说板子打好的时候我再开始改程序应该是来得及的。最近因为这个无线通信和数学的期末影响过多，我接下来的策略应该是无所事事就学rtos，其他两件事情可以先放放，我对于rtos的课程差不多是四倍 的关系，半个小时的教程我需要两个小时消化编程，今天我学习了大概六个小时，学不进去了，以后定下我自学时间至少是4个小时，其余时间可以写专利，对于无线通信zigbee放在最后，估计寒假期间应该是用不到无线了，其实无线通信是我们自己提出来的，所以不太合时宜，我接下来就是学习rtos，争取应用上，项目这边需要看手册以及协议，专利需要写。

2021/12/31，今天是本年的最后一天，我把LTC2944芯片手册看完了，现在觉得看完一款芯片其实用不了多久了，还记得第一次看数据手册的时候，差不多看了一周的时间，现在只需要四个小时左右就可以，明天可能会歇一整天吧

2022/1/1，元旦这天，是我有史以来最忙的一天，我居然早上九点半就来实验室了，一直呆到晚上11.30，今天看了下can接口的芯片，挺简单，但是can总线协议比较难，没看懂，晚上学了会rtos

2022/1/4，今天开始就要认真写专利了，虽然确实有点不想写，但是既然拿人家钱了，就要给人家干活，接下来项目就要暂时放一放了，全力整专利。

2022/1/5，今天专利写完了，晚上随便在哔哩哔哩上看点视频，再看看学习路径的讲解视频，明天把程序彻底改成状态机。

2022/1/6，今天专利打回来重新写，项目方面状态机出问题了

2022/1/7，今天状态机成功移植上去了！

2022/1/8，今天把状态机改完了，发到群里了，RTOS视频明天就能看完，然后下周开始就是全力把RTOS移植上去，争取在15号之前实现，然后就是开始全力攻ZigBee

2022/1/9，今天我把RTOS的视频全部看完了，后边将的东西就是把前面的重复讲了一遍，所以直接跳过，但我今天还是不打算直接移植，打算今天开始看看LINUX的视频，明天开始移植上系统

2022/1/10,今天正式开始移植了，目前已经把各个模块功能实现了，但问题是，还不能有效的使用RTOS框架，思路和状态机不一样

2022/1/11，可以把任务分成检测任务，显示任务，状态任务，FreeRTOS完成！今天完成的是对于FreeRTOS程序上的部分引脚修改，对于CANRX、CANTX、电量检测芯片的ALERT以及IIC程序，ZIGBEE的串口透传，以及main.c文件中流程，标志位判定

2022/1/12，今天起不做项目了，开始进入LINUX的领域

2022/1/15，今天板子到了，真的是很厚重很精致，进入了ARM全系列处理器，今天算是把开发环境基本搭建好了吧，，，算是正式进入了学习阶段

2022/1/16，今天被通知，可能不会那么早走了，也许二十多号之后了，一直在学LINUX

2020/1/20，今天晚上我就回家了，说实话如果老师不恶心我的话，我还不会这么早的回去，毕竟回去也没有事情做，看到其他人都撤退了，我心里也活泛了，回家吧，

- 项目方面：专利没有写完，程序上还剩下流程、电量检测芯片、can总线、无线zigbee，这次回家把专利以及zigbee写完吧！

2022/2/26,回学校的第二天，今天学习了下zigbee，差点把核心板烧了，晚上调了一个半点的程序，浪费时间，明天开始自己自学的东西要开始学习了

2022/2/27，今天打通了zigbee并且可以在报错的情况下传输数据，不过当printf函数过多时，只能给32连接的路由器重新上电，解决思路是把zigbee例程中路由器部分多写一行，每隔几秒向协调器发送信号保证路由器正常使用，听到了抓包器这个硬件，可以感知无线是否传送成功

2022/2/28，今天zigbee实现了，基本功能也实现了，明天开始外出实验，不过我更想的是学习linux，一个多月没学，差不多忘光了

2022/4/9，目前原太阳能小组在下位机中做出来的成果有：

搭载的外设有

1. 采集光照强度的光敏传感器bh1750
2. 控制充电的cn3722
3. 温度传感器ds18b20
4. 存储数据的eeprom
5. 显示以上数据的oled屏幕，以及若干采集电压，控制引脚的芯片

与外界的通信方式有

1. 发送控制指令的485有线通信
2. zigbee无线通信-广播

数据显示有

f1系列rct6的控制面板，采用lvgl绘制的gui界面lcd屏，可以模拟串口调试助手以及显示电量的多种示意图，通过zigbee的广播可以收到下位机采集的数据以及上位机树莓派的qt界面发送的数据，在两者发送控制指令时，下位机的接收缓冲区会被干扰

## 项目总结

这是我入学以来的第一个项目，下位机部分可以算是我完全独立研发，在本项目中，多次使用iic，spi,8080,usart,485,zigbee等通信方式，让我对这些通信有了丰富的经验，也见识了下ds18b20的单根数据线的三线通信，连时钟线都没有，也对模块化有了很深的感受，一旦耦合出问题后debug会很难，只能拆开调试，下位机开发的底层是引脚和时钟的配置，当各个模块通讯成功时并不是结束，把采集到的数据显示/打印在各种界面也是很大的工作量。可以说各个模块只不过是第一步。当采集的数据可以在屏幕上显示时，可以说完成了第二步，但此时单片机的性能并不够好，为了把状态分的彻底，需要引进状态机框架。之前看状态机原理中初始状态在发生事件后迁移到次状态，那个状态迁移图理解的总是不够好，也不知道应该如何实施，自己在网上找的代码，读懂每一行后移植到项目里，但这对我的c很有挑战性，第一次使用回调函数，结构体嵌套结构体，结构体数组。发生事件的时候并不一定会发生状态迁移，这取决于结构体数组的成员，将函数指针作为结构体成员，如果迁移就赋值为callback无效就是null，现在想想这些很简单都是套路，但对当时的我而言很难了，寒假前寒假期间寒假后我多次以为自己读懂了每一行代码，但是学完lvgl的里的事件回调函数我才对状态机框架有了全面的认识，回调函数只是一个函数！并没有什么异步性的神奇之处，那一切都是另外封装出来的，回调函数本身就是一个函数！当时在lvgl中没有找到回调函数赋实参这一步，应该是被藏在下一层了。但状态机中体现了。对于指针函数的应用也是在lvgl里明白的当初学freeRTOS的时候遗漏太多了，当初对任务句柄理解不了，这其实是面向对象的思维，返回的指针往往指向一个结构体，而这个结构体就是对象的属性，后来学c++的时候理解上畅通无阻，lvgl真的是最简单的了，一旦看懂之后回头看状态机才有了最后的认识。这期间自己写了个控制指令的发送和接收，控制指令格式是三个字节校验位是每个字节检验一次。当时觉得三个字节空间会大一些方便以后修改，但正式的校验都是检验后几位或者求和，也是懒得改了，幸亏跑到现在没出过bug。

上述这些还只是一块板的板内通信，当时自己觉得是时候学习无线通信了一直觉得这个很有趣，就跟师兄提了一嘴让我用zigbee实现串口透传的功能，找的是网蜂家的节点刚开始看人家的例程看不懂耶，怎么这么多的文件当时对层这个概念还没有深刻的认识，这也是学lvgl的时候发现的自己移植的那些文件属于“内核空间”，自己调用的api属于“用户空间”其实最早是在iic的时候就有点感觉了，现在学习linux驱动的时候理解上也能跟的上，自己是照着教程看的zigbee例程当时觉得串口透传只需要一点修改就能用例程跑不太甘心总想自己实现写东西。后来就改成了广播，也是因为zigbee核心板买多了不用白不用，也很简单.这些上层操作都是修改api就能实现了。

最后一块板用的是正点的迷你板，没办法画板的同门要陪对象，我也不好意思麻烦人家自己还不会画，能看懂pcb已经是挺满意了。当时觉得对oled屏幕的使用过于简单，b站上的怎么就那么好看呢，自己也就了解到GUI的存在，最后选择了比较新的lvgl毕竟正点出教程不看白不看。刚开始一天学一个控块主要学c，这东西就是对c的应用。学了十天最后两天看了20个控块都是堆积木，主要收获就是对c，分层，面向对象的理解。

挺感谢这项目的，更感谢我的两位同门如果没有他们的划水，我也无法独立完成整个下位机的开发。前几天接到“最高指示”，鉴于目前下位机完成了，把我调到外骨骼小组继续负责下位机的编程，这回的下位机是树莓派了。

















- 目前初步的想法是：把按键检测和串口消息放到中断中

- 把信号量交给按键检测时的紧急状态，只有当按键检测到上升沿的时侯，才会释放信号量

- 说到底，不会使用循环，而是使用优先级以及信号量来实现状态机的功能

- 创建任务不能是五个状态，需要细分下，因为这牵扯到优先级，这几个状态其实没必要

- 控制指令方面还需要整几个杂项信息的东西

- 有一个想法，每个任务都整个获取二值信号量，获取完之后就释放

- 把这五种状态放在一个函数中，进行判断，

- 可以分成这么几种，分别是状态任务，测量任务，显示任务，两个中断，一个信号量

- [ ] 把程序改成状态机，

- [ ] 再上个rtos的系统，

- [ ] 专利也需要写

  











































- [x] 目前基础功能已经可以实现
- [ ] 今天下午RS485可以实现通信的功能，eeprom的两个引脚可以实现高低电平，不过没有真正意义上实现控制指令以及存储的功能
- [ ] 需要更换成2.3寸的spi通信的屏幕，引脚分配需要注意
- [ ] 还需要增加电量检测芯片，引脚分配需要注意













- [x] 温度检测循环
- [x] 外部中断的紧急开关循环
- [x] 节能模式大循环，小循环

- [x] PWM、呼吸灯
- [x] EEPROM程序
- [x] 输出引脚需要修改
- [ ] 增加485的程序







- [ ] 首先，不需要定时器来控制PWM了，把呼吸灯改成闪烁，
- [x] 程序需要重新排版
- [x] 温度检测部分不需要死锁，改成标识位来进行if判定，模拟死循环的状态，让其他的标识位置位非工作
- [x] 紧急开关中断内部不要加循环，把循环去掉，内部的服务函数放在主函数里，中断放置标识位，主函数中不要有循环，
- [x] 没有必要的flag就不需要加了
- [x] 紧急开关中断分成高低电平，分别的标识位
- [x] flag_Power在if判定之后置1这个去掉，没有必要加
- [x] 传感器中断里的标识位需要重新修改

- [x] 对oled通讯成功
- [x] 在LCD上显示工作情况
- [x] 在oled上显示工作情况
- [x] 采集电压由oled正常显示
- [x] 采集电压进行平均
- [x] 中断问题对紧急开关以及整体逻辑的影响
- [x] 对温度传感器通讯成功
- [x] 对光敏传感器通讯成功 
- [x] 检测main函数中的逻辑
- [x] 在rct6上各个模块成功运行
- [x] 把呼吸灯程序，adc的采集程序，光照的采集程序放到定时器的中断中，就让定时器每秒中断一次，从而读取数据，显示函数也放到中断里
- [x] 接下来是紧急开关的标识位放到中断中，而不是把整个紧急开关函数放到中断中，在main函数中就用来if识别中断标志位
- [x] 中断不易过多，三个就可以了，最后一个还没想好怎么做
- [ ] 流程图需要重新画，可读性要增强。
- [ ] 按键需要进行软件反转，物理锁紧是按下去电路断开，这里虽然用的是上升沿下降沿都触发，但是可以通过检测此时引脚接收高低电平来区别出来，按下还是弹起
- [x] 死区问题也要注意，就是两个if判定之间容易出现忽高忽低的情况，加个延时就行
- [x] 虽然读取adc都是每秒读一次，但是往eeprom中存储并不需要这么快，而且存放的数据是温度的上下限，如果是光度的话，就每分钟储存一次即可，到时候往eeprom中存放的动作编成指令。
- [ ] 485的作用就是用来查看数据情况，以及编写控制指令，把控制指令分成八个字节，然后分别开头，最后再整一个标志位，这个可以把八个字节都相加进行检验。串口使用到的是ssrom小丁什么人用的，那个功能比较强大
- [ ] 还要把程序的上下顺序搞清楚
- [ ] 需要思考下用485远程操控要实现什么功能：1.把采集到的数据存到eeprom中，具体是什么数据再说
- [ ] 肯定是要整个中断来服务485函数，还要设计几个字节的控制命令，把软件搞明白
- [ ] 首先，写一个控制命令用来显示当前屏幕显示内容的。
- [ ] 





目前的问题：

1. 硬件部分的oled屏幕无法工作
2. USB转485程序部分无法工作
3. 5V降压模块电容焊反
4. 没有负载

调试方法：

1. 外设中只有LED灯可以显示，不过目前程序上出现问题，灯常亮，可以闪烁、无法呼吸
2. 万用表可以测量引脚电压
3. 软件上的DEBUG可以调试简单程序

调试任务：

1. 目前可以调试的

- [x] 控制LED灯

- [x] ## 控制蜂鸣器，不好使，只能听到细微的声音

- [x] 温度传感器，通过DEBUG观察

- [x] 光照传感器，通过DEBUG观察

- [x] ## 三个模拟量，通过DEBUG观察，这里有点问题，PA3还保留着，去掉之后不知道会不会留有bug，示数和电压表测的不一致，

- [x] USB供电模块

- [x] 3.3V的降压模块

- [x] STLINK接口

- [x] 有源晶振

  由可调电源来充当太阳能实现以下功能调试

  正常模式一

  - 由可调电源充当太阳能提供的28V来直接给负载以及3.3V供电，通过DEBUG观察给负载的电压

  正常模式二

  - 由可调电源充当太阳能提供的28V来给电池充电，电池给负载以及3.3V供电，通过DEBUG观察给负载的电压以及电池两端的电压

  这两种模式检测了，充电电路，供电电路，28-24降压电路，3.3V供电切换电路

  SWITCH引脚高低电平表现都是1.4V

2.延后调试的

- [ ] 加热模块因为需要28V电压，且加热情况不明显，延后
- [ ] EEPROM功能上不太重要，且调试方法不明显，延后
- [ ] 485模块，可以先用其他方法调试，程序没写好，延后
- [ ] 5V降压模块，电容焊反了，延后
- [ ] OLED屏幕，母座还没焊，延后





沈自所之后需要修改的

- [x] PD1切换成IO模式

- [x] SWITCH需要修改成反的

- [ ] ADC需要检测下

## FreeRTOS向下一版需要修改的

- [ ] 引脚需要修改

- [ ] 工作模式需要修改

- [x] 取消了正常模式1

- [ ] 光照强度没有任何作用，光照好与不好都不会改变工作模式，只有温度、电量会改变

- [ ] 当温度过低时，系统进入初始状态，加热

- [ ] 电量正常时，进入正常模式，当电量进入较低时，进入节能状态，此时电池不提供负载电压，当电池极低时，进入睡眠模式，此时电池只提供3.3v电压

- [ ] 当按下紧急开关时，进入紧急开关，不考虑加热以及电池情况

- [ ] 一个总线上IIC挂两个外设，需要考虑

  
